
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>é‡‡è´­æŠ¥ä»·æ¯”ä»·åŠ©æ‰‹</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    .modal-overlay { background-color: rgba(0, 0, 0, 0.4); }
    /* æ·»åŠ æ–°çš„æ ·å¼ */
    .exchange-rate {
      font-size: 0.75rem; /* å­—ä½“å˜å° */
      color: #666; /* ç°è‰²æ–‡å­—ï¼Œç¬¦åˆå•†åŠ¡ç®€æ´é£ */
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; /* è‹¹æœé£æ ¼å­—ä½“ */
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-900 p-6 font-sans">
  <div class="max-w-4xl mx-auto space-y-6">
    <div class="text-center">
      <h1 class="text-3xl font-semibold">é‡‡è´­æŠ¥ä»·æ¯”ä»·åŠ©æ‰‹</h1>
      <!-- ä¿®æ”¹æ±‡ç‡æ˜¾ç¤ºéƒ¨åˆ† -->
      <div class="my-4"></div> <!-- æ·»åŠ é¡¶éƒ¨ç•™ç™½ -->
      <p class="exchange-rate">ğŸ’± å›ºå®šæ±‡ç‡ï¼ˆç”¨äºæ¯”ä»·è®¡ç®—ï¼‰ï¼š1 ç¾å…ƒ = 7.30 äººæ°‘å¸ï¼Œ1 æ¬§å…ƒ = 7.90 äººæ°‘å¸ï¼Œ1 æ¸¯å¸ = 0.93 äººæ°‘å¸ï¼Œ1 æ—¥å…ƒ = 0.05 äººæ°‘å¸</p>
      <div class="my-4"></div> <!-- æ·»åŠ åº•éƒ¨ç•™ç™½ -->
      <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
      <h2 class="text-lg font-medium mb-4">æŠ¥ä»·ä¿¡æ¯å½•å…¥</h2>
      <form id="quote-form" class="space-y-3">
        <div id="rows-container" class="space-y-2">
          <div class="grid grid-cols-8 gap-2 items-center row-item">
            <input placeholder="ä¾›åº”å•†" class="col-span-1 border p-2 rounded" />
            <input placeholder="äº§å“" class="col-span-1 border p-2 rounded" />
            <input placeholder="å•ä»·" type="number" class="col-span-1 border p-2 rounded" />
            <select class="col-span-1 border p-2 rounded">
              <option>CNY</option>
              <option>USD</option>
              <option>EUR</option>
              <option>JPY</option>
              <option>HKD</option>
            </select>
            <input placeholder="äº¤æœŸ(å¤©)" type="number" class="col-span-1 border p-2 rounded" />
            <input placeholder="å¤‡æ³¨" class="col-span-1 border p-2 rounded" />
            <div class="col-span-1 flex space-x-1 justify-center">
              <button type="button" class="clear-row bg-gray-100 text-gray-600 px-3 py-1 rounded hover:bg-gray-200 text-sm transition">æ¸…ç©º</button>
              <button type="button" class="delete-row bg-red-100 text-red-600 px-3 py-1 rounded hover:bg-red-200 text-sm transition">åˆ é™¤</button>
            </div>
          </div>
        </div>
        <div class="flex flex-wrap gap-2 mt-2">
          <button type="button" id="add-row" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition">â• æ·»åŠ ä¾›åº”å•†</button>
          <button type="button" id="load-demo" data-state="init" class="bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 transition"><span id="load-demo-text">ğŸ¯ åŠ è½½ç¤ºä¾‹é¡¹ç›®</span></button>
          <button type="button" id="undo-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded transition">æ’¤é”€ä¸Šä¸€æ­¥</button>
        </div>
      </form>
    </div>
    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
      <h2 class="text-lg font-medium mb-4">è¯„åˆ†æƒé‡è®¾ç½®</h2>
      <div class="flex flex-wrap gap-6 items-center">
        <div class="flex items-center space-x-2">
          <label for="weight-price" class="text-sm text-gray-600">ä»·æ ¼æƒé‡ï¼ˆ%ï¼‰</label>
          <input id="weight-price" type="number" class="border p-1.5 rounded w-28 focus:ring-2 focus:ring-blue-300 hover:ring-1 hover:ring-blue-200 transition" />
        </div>
        <div class="flex items-center space-x-2">
          <label for="weight-delivery" class="text-sm text-gray-600">äº¤æœŸæƒé‡ï¼ˆ%ï¼‰</label>
          <input id="weight-delivery" type="number" class="border p-1.5 rounded w-28 focus:ring-2 focus:ring-blue-300 hover:ring-1 hover:ring-blue-200 transition" />
        </div>
      </div>
      <p class="text-xs text-gray-500 mt-2">ä¸å¡«å†™æ—¶ï¼Œé»˜è®¤ä»·æ ¼å  60%ï¼Œäº¤æœŸå  40%</p>
    </div>
    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
      <h2 class="text-lg font-medium mb-4">æ“ä½œåŒºåŸŸ</h2>
      <div class="flex flex-wrap gap-4 items-center">
        <button id="generate" class="bg-green-600 text-white px-6 py-2 rounded text-lg hover:bg-green-700 transition">ğŸ“Š ç”Ÿæˆå¯¹æ¯”å›¾</button>
        <button id="export-excel" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">â¬‡ï¸ å¯¼å‡ºä¸º Excel</button>
        <button id="export-chart" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 transition">ğŸ–¼ï¸ å¯¼å‡ºå›¾è¡¨å›¾ç‰‡</button>
      </div>
    </div>
    <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-200">
      <h2 class="text-lg font-medium mb-4">è¯„åˆ†å¯¹æ¯”å›¾</h2>
      <canvas id="price-chart" class="h-64"></canvas>
      <p class="text-xs text-gray-500 mt-4 leading-relaxed border-t pt-3">
        <strong>è¯„åˆ†è¯´æ˜ï¼š</strong><br>
        ç»¼åˆå¾—åˆ† = ä»·æ ¼å¾—åˆ† Ã— æƒé‡ + äº¤æœŸå¾—åˆ† Ã— æƒé‡ã€‚<br><br>
        - ä»·æ ¼å¾—åˆ† = 100 - ï¼ˆè¯¥æŠ¥ä»· - æœ€ä½æŠ¥ä»·ï¼‰Ã·ï¼ˆæœ€é«˜æŠ¥ä»· - æœ€ä½æŠ¥ä»·ï¼‰Ã— 100<br>
        - äº¤æœŸå¾—åˆ† = 100 - ï¼ˆè¯¥äº¤æœŸ - æœ€å¿«äº¤æœŸï¼‰Ã·ï¼ˆæœ€æ…¢äº¤æœŸ - æœ€å¿«äº¤æœŸï¼‰Ã— 100<br><br>
        âœ… åˆ†æ•°è¶Šé«˜ï¼Œè¡¨ç¤ºç»¼åˆæ€§ä»·æ¯”è¶Šä¼˜ï¼Œä»…ä¾›å‚è€ƒã€‚
      </p>
    </div>
  </div>
  <!-- å®Œå…¨ç§»é™¤æ®‹ç•™çš„åé¦ˆæ¨¡æ€æ¡†ä»£ç  -->
  <button id="feedback-button" 
          onclick="window.open('https://j1hixknr5u6.feishu.cn/share/base/form/shrcnS0BKuR4jGdh5BcwLgZWGHb', '_blank')" 
          class="fixed bottom-6 right-6 bg-yellow-500 text-white px-4 py-2 rounded-full shadow-lg hover:bg-yellow-600 transition z-50">
    ğŸ’¬ åé¦ˆæ„è§
  </button>
  
  <script>
    // æ’¤é”€å †æ ˆ
    let undoStack = [];
    // è·å–å½“å‰rowsæ•°æ®
    function getRowsData() {
      return Array.from(document.querySelectorAll("#rows-container .row-item")).map(row => ({
        supplier: row.children[0].value,
        product: row.children[1].value,
        price: row.children[2].value,
        currency: row.children[3].value,
        delivery: row.children[4].value,
        note: row.children[5].value
      }));
    }
    // ç”¨æ•°æ®é‡ç»˜æ‰€æœ‰è¡Œ
    function setRowsData(data) {
      const container = document.getElementById("rows-container");
      container.innerHTML = "";
      data.forEach(item => {
        const row = document.createElement("div");
        row.className = "grid grid-cols-8 gap-2 items-center row-item";
        row.innerHTML = `
          <input value="${item.supplier}" placeholder="ä¾›åº”å•†" class="col-span-1 border p-2 rounded" />
          <input value="${item.product}" placeholder="äº§å“" class="col-span-1 border p-2 rounded" />
          <input value="${item.price}" placeholder="å•ä»·" type="number" class="col-span-1 border p-2 rounded" />
          <select class="col-span-1 border p-2 rounded">
            <option ${item.currency==="CNY"?"selected":""}>CNY</option>
            <option ${item.currency==="USD"?"selected":""}>USD</option>
            <option ${item.currency==="EUR"?"selected":""}>EUR</option>
            <option ${item.currency==="JPY"?"selected":""}>JPY</option>
            <option ${item.currency==="HKD"?"selected":""}>HKD</option>
          </select>
          <input value="${item.delivery}" placeholder="äº¤æœŸ(å¤©)" type="number" class="col-span-1 border p-2 rounded" />
          <input value="${item.note}" placeholder="å¤‡æ³¨" class="col-span-1 border p-2 rounded" />
          <div class="col-span-1 flex space-x-1 justify-center">
            <button type="button" class="clear-row bg-gray-100 text-gray-600 px-3 py-1 rounded hover:bg-gray-200 text-sm transition">æ¸…ç©º</button>
            <button type="button" class="delete-row bg-red-100 text-red-600 px-3 py-1 rounded hover:bg-red-200 text-sm transition">åˆ é™¤</button>
          </div>
        `;
        container.appendChild(row);
      });
      bindAllRowEvents();
    }
    // ç»‘å®šè¡ŒæŒ‰é’®äº‹ä»¶
    function bindRowEvents(row) {
      row.querySelector(".clear-row").onclick = function() {
        pushUndo();
        row.querySelectorAll("input").forEach(i => i.value = "");
        row.querySelectorAll("select").forEach(s => s.selectedIndex = 0);
        // æ¯æ¬¡æ•°æ®å˜æ›´åä¿å­˜æ•°æ®
        localStorage.setItem('procurementData', JSON.stringify(getRowsData()));
      };
      row.querySelector(".delete-row").onclick = function() {
        pushUndo();
        row.remove();
        // æ¯æ¬¡æ•°æ®å˜æ›´åä¿å­˜æ•°æ®
        localStorage.setItem('procurementData', JSON.stringify(getRowsData()));
      };
    }
    function bindAllRowEvents() {
      document.querySelectorAll(".row-item").forEach(bindRowEvents);
    }
    // æ·»åŠ ä¾›åº”å•†è¡Œ
    document.getElementById("add-row").onclick = function() {
      pushUndo();
      const container = document.getElementById("rows-container");
      const row = document.createElement("div");
      row.className = "grid grid-cols-8 gap-2 items-center row-item";
      row.innerHTML = `
        <input placeholder="ä¾›åº”å•†" class="col-span-1 border p-2 rounded" />
        <input placeholder="äº§å“" class="col-span-1 border p-2 rounded" />
        <input placeholder="å•ä»·" type="number" class="col-span-1 border p-2 rounded" />
        <select class="col-span-1 border p-2 rounded">
          <option>CNY</option>
          <option>USD</option>
          <option>EUR</option>
          <option>JPY</option>
          <option>HKD</option>
        </select>
        <input placeholder="äº¤æœŸ(å¤©)" type="number" class="col-span-1 border p-2 rounded" />
        <input placeholder="å¤‡æ³¨" class="col-span-1 border p-2 rounded" />
        <div class="col-span-1 flex space-x-1 justify-center">
          <button type="button" class="clear-row bg-gray-100 text-gray-600 px-3 py-1 rounded hover:bg-gray-200 text-sm transition">æ¸…ç©º</button>
          <button type="button" class="delete-row bg-red-100 text-red-600 px-3 py-1 rounded hover:bg-red-200 text-sm transition">åˆ é™¤</button>
        </div>
      `;
      container.appendChild(row);
      bindRowEvents(row);
      // æ¯æ¬¡æ•°æ®å˜æ›´åä¿å­˜æ•°æ®
      localStorage.setItem('procurementData', JSON.stringify(getRowsData()));
    };
    // åŠ è½½/æ¸…ç©ºç¤ºä¾‹
    document.getElementById("load-demo").onclick = function() {
      const container = document.getElementById("rows-container");
      const btn = document.getElementById("load-demo");
      const btnText = document.getElementById("load-demo-text");
      pushUndo();
      if (btn.dataset.state === "init") {
        const exampleData = [
          { supplier: "ä¾›åº”å•†A", product: "ç¡…ç‰‡", price: 98, currency: "CNY", delivery: 5, note: "è€å®¢æˆ·" },
          { supplier: "ä¾›åº”å•†B", product: "ç¡…ç‰‡", price: 103, currency: "CNY", delivery: 7, note: "äº¤æœŸç¨æ…¢" },
          { supplier: "ä¾›åº”å•†C", product: "ç¡…ç‰‡", price: 95, currency: "CNY", delivery: 10, note: "é¦–æ¬¡åˆä½œ" }
        ];
        setRowsData(exampleData);
        btn.dataset.state = "loaded";
        btnText.innerText = "ğŸ§¹ æ¸…ç©ºç¤ºä¾‹é¡¹ç›®";
      } else {
        setRowsData([{
          supplier: "", product: "", price: "", currency: "CNY", delivery: "", note: ""
        }]);
        btn.dataset.state = "init";
        btnText.innerText = "ğŸ¯ åŠ è½½ç¤ºä¾‹é¡¹ç›®";
      }
      // æ¯æ¬¡æ•°æ®å˜æ›´åä¿å­˜æ•°æ®
      localStorage.setItem('procurementData', JSON.stringify(getRowsData()));
    };
    // æ’¤é”€åŠŸèƒ½
    function pushUndo() {
      undoStack.push(getRowsData());
      if (undoStack.length > 30) undoStack.shift();
    }
    document.getElementById("undo-btn").onclick = function() {
      if (undoStack.length === 0) {
        alert("æ²¡æœ‰å¯æ’¤é”€çš„æ­¥éª¤ï¼");
        return;
      }
      setRowsData(undoStack.pop());
      // æ¯æ¬¡æ•°æ®å˜æ›´åä¿å­˜æ•°æ®
      localStorage.setItem('procurementData', JSON.stringify(getRowsData()));
    };
    // åˆå§‹ç»‘å®šæ‰€æœ‰è¡ŒæŒ‰é’®
    bindAllRowEvents();

    // é¡µé¢åŠ è½½æ—¶æ¢å¤æ•°æ®
    window.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('procurementData');
      if (saved) setRowsData(JSON.parse(saved));
    });

    // åˆ é™¤ä»¥ä¸‹æ®‹ç•™çš„åé¦ˆå¼¹çª—ä»£ç 
    // document.getElementById("feedback-button").onclick = function() {
    //   document.getElementById("feedback-modal").classList.remove("hidden");
    // };
    // document.getElementById("feedback-cancel").onclick = function() {
    //   document.getElementById("feedback-modal").classList.add("hidden");
    // };
    // document.getElementById("feedback-submit").onclick = function() {
    //   const fbText = document.getElementById("feedback-text");
    //   const content = fbText.value.trim();
    //   if (!content) return alert("è¯·å¡«å†™æ„è§å†…å®¹ï¼");
    //   const list = JSON.parse(localStorage.getItem("feedbacks") || "[]");
    //   list.push({ text: content, time: new Date().toISOString() });
    //   localStorage.setItem("feedbacks", JSON.stringify(list));
    //   alert("æ„Ÿè°¢ä½ çš„åé¦ˆï¼");
    //   fbText.value = "";
    //   document.getElementById("feedback-modal").classList.add("hidden");
    // };
  </script>
  <script src="main.js"></script>
</body>
</html>
